var ui={intialControlsVisible:!0,robotFlickeringHandle:0,currentView:"",startRobotFlickering:function(){ui.robotFlickeringHandle=setInterval(function(){$("#robot").toggleClass("robot")},500)},stopRobotFlickering:function(){clearInterval(ui.robotFlickeringHandle)},switchViewTo:function(t){function n(t){ui.currentView="#"+t,$(ui.currentView).fadeIn("fast"),"ai"===t&&ui.startRobotFlickering()}ui.intialControlsVisible?(ui.intialControlsVisible=!1,$(".intial").fadeOut({duration:"slow",done:function(){n(t)}})):$(ui.currentView).fadeOut({duration:"fast",done:function(){n(t)}})},insertAt:function(t,n){var i=$(".cell"),r=$(i[t]);r.hasClass("occupied")||(r.html(n),r.css({color:"X"==n?"green":"red"}),r.addClass("occupied"))}},State=function(t){if(this.turn="",this.oMovesCount=0,this.result="still running",this.board=[],void 0!==t){var n=t.board.length;this.board=new Array(n);for(var i=0;i<n;i++)this.board[i]=t.board[i];this.oMovesCount=t.oMovesCount,this.result=t.result,this.turn=t.turn}this.advanceTurn=function(){this.turn="X"===this.turn?"O":"X"},this.emptyCells=function(){for(var t=[],n=0;n<9;n++)"E"===this.board[n]&&t.push(n);return t},this.isTerminal=function(){for(var t=this.board,n=0;n<=6;n+=3)if("E"!==t[n]&&t[n]===t[n+1]&&t[n+1]==t[n+2])return this.result=t[n]+"-won",!0;for(n=0;n<=2;n++)if("E"!==t[n]&&t[n]===t[n+3]&&t[n+3]===t[n+6])return this.result=t[n]+"-won",!0;n=0;for(var i=4;n<=2;n+=2,i-=2)if("E"!==t[n]&&t[n]==t[n+i]&&t[n+i]===t[n+2*i])return this.result=t[n]+"-won",!0;return 0==this.emptyCells().length&&(this.result="draw",!0)}},Game=function(t){this.ai=t,this.currentState=new State,this.currentState.board=["E","E","E","E","E","E","E","E","E"],this.currentState.turn=Game.randomTurn(),this.status="beginning",this.advanceTo=function(t){this.currentState=t,t.isTerminal()?(this.status="ended","X-won"===t.result?ui.switchViewTo("won"):"O-won"===t.result?ui.switchViewTo("lost"):ui.switchViewTo("draw")):"X"===this.currentState.turn?ui.switchViewTo("human"):this.ai.notify("O")},this.start=function(){(this.status="beginning")&&(this.advanceTo(this.currentState),this.status="running")}};Game.score=function(t){return"X-won"===t.result?10-t.oMovesCount:"O-won"===t.result?-10+t.oMovesCount:0},Game.randomTurn=function(){for(var t="",n="XOXOXO".length,i=0;i<1;i++)t+="XOXOXO".charAt(Math.floor(Math.random()*n));return t};var AIAction=function(t){this.movePosition=t,this.minimaxVal=0,this.applyTo=function(t){var n=new State(t);return n.board[this.movePosition]=t.turn,"O"===t.turn&&n.oMovesCount++,n.advanceTurn(),n}};AIAction.ASCENDING=function(t,n){return t.minimaxVal<n.minimaxVal?-1:t.minimaxVal>n.minimaxVal?1:0},AIAction.DESCENDING=function(t,n){return t.minimaxVal>n.minimaxVal?-1:t.minimaxVal<n.minimaxVal?1:0};var AI=function(){var t={};function n(n){var i=t.currentState.emptyCells().map(function(n){var i=new AIAction(n),r=i.applyTo(t.currentState);return i.minimaxVal=function t(n){return n.isTerminal()?Game.score(n):(i="X"===n.turn?-1e3:1e3,n.emptyCells().map(function(t){return new AIAction(t).applyTo(n)}).forEach(function(r){var o=t(r);"X"===n.turn?o>i&&(i=o):o<i&&(i=o)}),i);var i}(r),i});"X"===n?i.sort(AIAction.DESCENDING):i.sort(AIAction.ASCENDING);var r=i[0],o=r.applyTo(t.currentState);ui.insertAt(r.movePosition,n),t.advanceTo(o)}this.plays=function(n){t=n},this.notify=function(t){n(t)}};
